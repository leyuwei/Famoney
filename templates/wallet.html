{{define "content"}}
<div class="wallet-card mb-3" style="{{if .Wallet.Color}}background: {{.Wallet.Color}};{{end}}">
  <h2>{{.Wallet.Name}}</h2>
  <div class="row balance-cards mb-3">
  {{range $cur, $bal := .Wallet.Balances}}
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title">{{$cur}}</h5>
          <p class="card-text">{{printf "%.2f" $bal}}</p>
        </div>
      </div>
    </div>
  {{end}}
  </div>
</div>

<div class="mb-3">
  <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addFlowModal">{{T "Add"}} {{T "Amount"}}</button>
  <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#updateBalanceModal">{{T "UpdateBalance"}}</button>
  <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#shareWalletModal">{{T "ShareWallet"}}</button>
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editWalletModal">{{T "EditWallet"}}</button>
</div>

<h3>{{T "Category"}} {{T "Balance"}}</h3>
<table class="table table-bordered w-50">
  <thead><tr><th>{{T "Category"}}</th><th>{{T "Balance"}}</th></tr></thead>
  <tbody>
  {{range $cid, $bal := .Wallet.CategoryBalances}}
    <tr><td>{{(index $.Categories $cid).Name}}</td><td>{{printf "%.2f" $bal}}</td></tr>
  {{else}}
    <tr><td colspan="2">{{T "NoFlows"}}</td></tr>
  {{end}}
  </tbody>
</table>

<h3>{{T "Flows"}}</h3>
<table class="table table-striped">
<thead><tr><th>{{T "Amount"}}</th><th>{{T "Category"}}</th><th>{{T "Description"}}</th><th>{{T "Operator"}}</th><th>{{T "Time"}}</th><th>{{T "Actions"}}</th></tr></thead>
<tbody>
{{range .Flows}}
<tr>
  <td>{{.Amount}} {{.Currency}}</td>
  <td>{{(index $.Categories .CategoryID).Name}}</td>
  <td>{{.Description}}</td>
  <td>{{.Operator}}</td>
  <td>{{.CreatedAt}}</td>
  <td>
    <a href="/famoney/flow/{{.ID}}/edit" class="btn btn-sm btn-secondary">{{T "Edit"}}</a>
    <form method="POST" action="/famoney/flow/{{.ID}}/delete" class="d-inline">
      <button type="submit" class="btn btn-sm btn-danger">{{T "Delete"}}</button>
    </form>
  </td>
</tr>
{{else}}
<tr><td colspan="6">{{T "NoFlows"}}</td></tr>
{{end}}
</tbody>
</table>

<form method="POST" action="/famoney/wallet/{{.Wallet.ID}}/delete" class="mt-4" onsubmit="return confirm('{{T "Confirm"}}');">
  <button type="submit" class="btn btn-danger">{{T "Delete"}}</button>
</form>

<div class="modal fade" id="addFlowModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="/famoney/wallet/{{.Wallet.ID}}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{T "Add"}} {{T "Amount"}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{T "Close"}}"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="action" value="flow">
        <div class="mb-3"><input class="form-control" name="amount" placeholder="{{T "Amount"}}"></div>
        <div class="mb-3">
          <select name="currency" class="form-select">
            {{range $.Currencies}}<option value="{{.}}">{{.}}</option>{{end}}
          </select>
        </div>
        <div class="mb-3">
          <select name="category" class="form-select">
            {{range $id, $c := .Categories}}
              <option value="{{$id}}">{{$c.Name}}</option>
            {{end}}
          </select>
        </div>
        <div class="mb-3"><input class="form-control" name="description" placeholder="{{T "Description"}}"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{T "Close"}}</button>
        <button type="submit" class="btn btn-primary">{{T "Add"}}</button>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="updateBalanceModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="/famoney/wallet/{{.Wallet.ID}}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{T "UpdateBalance"}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{T "Close"}}"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="action" value="balance">
        <div class="mb-3"><input class="form-control" name="amount" placeholder="{{T "Balance"}}"></div>
        <div class="mb-3">
          <select name="currency" class="form-select">
            {{range $.Currencies}}<option value="{{.}}">{{.}}</option>{{end}}
          </select>
        </div>
        <div class="mb-3">
          <select name="category" class="form-select">
            {{range $id, $c := .Categories}}
              <option value="{{$id}}">{{$c.Name}}</option>
            {{end}}
          </select>
        </div>
        <div class="mb-3"><input class="form-control" name="description" placeholder="{{T "Description"}}"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{T "Close"}}</button>
        <button type="submit" class="btn btn-primary">{{T "Confirm"}}</button>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="shareWalletModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{T "ShareWallet"}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{T "Close"}}"></button>
      </div>
      <div class="modal-body">
        <form id="share-form" method="POST" action="/famoney/wallet/{{.Wallet.ID}}">
          <input type="hidden" name="action" value="share">
          <div class="mb-3">
            <label class="form-label">{{T "AllUsers"}}</label>
            <select class="form-select" name="username">
              {{range .Users}}<option value="{{.}}">{{.}}</option>{{end}}
            </select>
          </div>
        </form>
        <div>
          <h6>{{T "SharedUsers"}}</h6>
          <ul class="list-group">
            {{range .Owners}}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{.}}
              {{if ne . $.CurrentUser}}
              <form method="POST" action="/famoney/wallet/{{$.Wallet.ID}}" class="ms-2">
                <input type="hidden" name="action" value="unshare">
                <input type="hidden" name="username" value="{{.}}">
                <button type="submit" class="btn btn-sm btn-danger">{{T "Unshare"}}</button>
              </form>
              {{end}}
            </li>
            {{end}}
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{T "Close"}}</button>
        <button type="submit" form="share-form" class="btn btn-primary">{{T "Share"}}</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editWalletModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="/famoney/wallet/{{.Wallet.ID}}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{T "EditWallet"}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{T "Close"}}"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="action" value="rename">
        <div class="mb-3"><input class="form-control" name="name" value="{{.Wallet.Name}}"></div>
        <div class="mb-3">
          <label class="form-label">{{T "Color"}}</label>
          <input type="color" class="form-control form-control-color" name="color" value="{{.Wallet.Color}}">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{T "Close"}}</button>
        <button type="submit" class="btn btn-primary">{{T "Edit"}}</button>
      </div>
    </form>
  </div>
</div>

{{end}}
